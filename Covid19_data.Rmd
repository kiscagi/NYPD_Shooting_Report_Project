---
title: "Covid-19 Data"
author: "T.Panzarino"
date: "2024-03-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Covid-19 Data Exploration Project

For this project we will be importing our data from Johns Hopkins University. File names are read in. Global cases, global deaths, US cases and US deaths are established.

```{r get_jhu_data}
library(tidyverse)
url_in <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"
file_names <- c("time_series_covid19_confirmed_global.csv",
"time_series_covid19_confirmed_US.csv",
"time_series_covid19_deaths_global.csv", "time_series_covid19_deaths_US.csv" )

urls <- str_c(url_in,file_names)
```

```{r import_data, message=FALSE}
global_cases <- read.csv(urls[1])
global_deaths <- read.csv(urls[3])
US_cases <- read.csv(urls[2])
US_deaths <- read.csv(urls[4])
```

## Tidying Data:

Global data and US data is tidied by changing the multiple date columns to a single column containing all dates. Province/State, Country/Region, date, cases, and deaths remain. Other columns are considered extraneous and removed. Date values are fixed to remove "X" before value and change into a more usable format. For both Global and US data, Cases and Deaths are joined into a single data set for easier visibility under "global" and "US" data sets. Cases are filtered to be greater than 0.

```{r tidy_global_data}
global_cases <- global_cases %>%
  pivot_longer(cols = -c(`Province.State`, `Country.Region`, Lat, Long), names_to = "date", values_to = "cases") %>%
  select(-c(Lat,Long))

global_deaths <- global_deaths %>%
  pivot_longer(cols = -c(`Province.State`, `Country.Region`, Lat, Long), names_to = "date", values_to = "deaths") %>%
  select(-c(Lat,Long))


library(lubridate)


global <- global_cases %>%
  full_join(global_deaths) %>%
  rename(Country_Region = `Country.Region`, Province_State = `Province.State`) %>%
  mutate(across(date, function(x){
    mdy(gsub('X','', x))
  }))

global <-global %>% filter(cases > 0)

summary(global)


```

```{r tidy_us_data}

US_cases <- US_cases %>%
  pivot_longer(cols = -(UID:Combined_Key), names_to = "date", values_to = "cases") %>%
  select(Admin2:cases) %>%
  mutate(across(date, function(x){
    mdy(gsub('X','', x))
  })) %>%
  select(-c(Lat,Long_))


US_deaths <- US_deaths %>%
  pivot_longer(cols = -(UID:Population), names_to = "date", values_to = "deaths") %>%
  select(Admin2:deaths) %>%
  mutate(across(date, function(x){
    mdy(gsub('X','', x))
  })) %>%
  select(-c(Lat,Long_))

US <- US_cases %>%
  full_join(US_deaths)

summary(US)

```

Summary data for total cases and deaths per country is determined. Maximum values of cases and deaths was used to get the total amount. A heat map was utilized using death totals and a world map to see a visual representation of total deaths worldwide. It is interesting to see that the largest amount of deaths according to this data set are in the United states, followed by Brazil, Russia and India.

```{r country totals summarization}

global_by_country <-global %>%
  group_by(Country_Region) %>%
  summarize(cases = max(cases), deaths= max(deaths)) %>%
  select(Country_Region, cases, deaths) %>%
  ungroup()

global_by_country$Country_Region[global_by_country$Country_Region == "US"] <- 'USA'
```

## Visualization #1

```{r world_death_heat_map}
library(scales)

world_map <-map_data("world")
ggplot(global_by_country) +
  geom_map(
    data = world_map, map = world_map, aes(map_id = region),
    fill = "white", color = "cadetblue3"
  ) +
  geom_map(map = world_map, aes(map_id = Country_Region, fill = deaths)) +
  scale_fill_gradient(low = "thistle1", high = "purple1", name = "Deaths", labels = comma) +
  expand_limits(x = world_map$long, y = world_map$lat) +
  labs(title = "Covid-19 Total Worldwide Deaths", y = NULL)

```

It may be interesting to explore world data, minus the influence of the United States. Daily sums of case data and sum data was calculated, then mutated to only include the new cases and new deaths. These new cases and deaths are then plotted in order to visualize the cases and deaths over time.

```{r world_total_minus_US}
global_totals  <- global %>%
  filter(! "United States" %in% Country_Region) %>%
  group_by(date) %>%
  summarise(Country_Region = "world", cases = sum(cases), deaths = sum(deaths)) %>%
  ungroup() 
global_totals <- global_totals %>%
   mutate(new_cases = cases - lag(cases), new_deaths = deaths - lag(deaths))

```

## Visualization #2

```{r global totals new values visualization}
global_totals %>%
  filter(cases > 0) %>%
  ggplot(aes(x = date, y = new_cases)) +
  geom_line(aes(color = "new_cases")) +
  geom_point(aes(color = "new_cases")) +
  geom_line(aes(y = new_deaths, color = "new_deaths")) +
  geom_point(aes(y = new_deaths, color = "new_deaths")) +
  scale_y_log10() +
  theme(legend.position = "bottom", axis.text.x = element_text(angle = 90)) +
  labs(title = "Covid19 New Cases and Deaths Outside of United States", y = NULL)
```


## Model

Because the plot appears to have a logarithmic relationship between time(the date) and the number of new cases, I thought it may be interesting to explore as a model. I changed the date to numerical values to facilitate this.

```{r log_model}

mod <- lm(new_cases ~ log(as.numeric(date)), data = global_totals)
summary(mod)


```

## Bias and Conclusion:

Some bias that I believe may be present in this data is under-reporting of Covid-19 case and death numbers by certain countries. This topic was heavily debated in the news and we may not know if these numbers are accurate. I also have some bias because I have only lived in the United States, so I may focus on United States and give it more importance. This is why I plotted global new cases and deaths minus the data from the United States.

From the world map visualization it appears that the United States has the majority of deaths, followed by Russia, Brazil and India. This may be due to the fact that these countries have large populations. Population data was not included in the global data, but in the future it may be interesting to explore deaths in relation to population of a country/region.

From the world data new cases and new deaths (minus the United States), we can see the initial spike in early 2020 in the beginning of the pandemic. World cases appear to peak around early 2022, and world deaths appear to have some outlying high values in early 2023. It would be interesting to explore those values further and see which countries are contributing the most to that spike. Ignoring those outlying high new death values, deaths appear to stay stagnant until mid 2022, when they start to reduce slightly.

From running the model on the logarithmic relationship between the date and the number of new cases, we can see that the model yielded an F-Value of 125.2 and a p-value of 2.2 x 10^-16. This very low p-value, meaning there is a low likelihood of getting new_case data similar to our data set if the date/time had no effect on the case numbers. that shows that this model is useful for this data
